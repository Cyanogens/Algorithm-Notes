##### [[中等]]
##### [[模拟]]

遍历所有可能的子数组，并维护子数组的最大值和最小值，然后直接计算 $ans$ 即可。

##### [[单调栈]]
根据范围和的定义，我们可以推出范围和 $sum$ 的计算公式为
$$
sum = \sum max + \sum min
$$
其中，$max$ 为子数组中的最大值， $min$ 为子数组中的最小值。

对于每个数 $nums[i]$ ，我们判断其值在多少个区间内充当最大/最小值。当 $nums[i]$ 要充当区间内的最小值时，我们可以寻找左右两侧最近的 **不大于** $nums[i]$ 的下标 $left$ 和 $right$ 并记录。当 $nums[i]$ 要充当区间内的最大值时，我们可以寻找左右两侧最近的 **不小于** $nums[i]$ 的下标 $left$ 和 $right$ 并记录。再根据其左右下标组成的区间，根据乘法原理计算 $nums[i]$ 在多少个子数组里充当最大/最小值。

要注意是，由于数组中存在重复元素，就有可能导致重复的情况（例如在数组 $[1,2,3,2,1,2,3,2,1]$ 中，对于下标为 $1$ 的元素 $2$ 和下标为 $3$ 的 元素 $2$ 来说，下标 $1$ 的右侧部分和下标 $3$ 的左侧部分是会重复的），所以，我们在判断的时候，就令区间为左闭右开 $[leftMin, rightMin)$ ，这样避免重复的情况。
